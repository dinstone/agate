import{u as a,a as e,_ as t}from"./useTable-881f194b.js";import{d as l,Z as s,u as i,r as o,s as n,e as d,J as p,B as r,O as u,K as c,o as m,c as g,w as f,a as b,f as y,t as w,P as x,R as j,k as h}from"./index-3c676471.js";/* empty css                  */import{g as v,d as k,c as D,s as S}from"./route-9e16cfa1.js";import{a as _}from"./apps-4e09a066.js";import{u as C}from"./useEmitt-ee4726c6.js";import{D as P}from"./Descriptions-02f072d1.js";/* empty css                *//* empty css                  */import"./tsxHelper-101a6832.js";/* empty css                         *//* empty css                       */import"./index-5586c822.js";const R={class:"mb-10px"};function z(a){return"function"==typeof a||"[object Object]"===Object.prototype.toString.call(a)&&!j(a)}const L=l({name:"RouteListPage",__name:"List",setup(l){const{query:j}=s(),{push:L,go:E}=i(),{t:$}=h(),A=o({});(async()=>{const a=await _({id:j.app});A.value=a.data})();const O=o([]),{tableRegister:U,tableState:B,tableMethods:H}=a({fetchDataApi:async()=>{const{currentPage:a,pageSize:e}=B,t=await v({appId:j.app,pageIndex:b(a),pageSize:b(e)});return{list:t.data.list,total:t.data.total}},fetchDelApi:async()=>!!(await k(b(O)))}),{loading:I,dataList:M,total:T,currentPage:q,pageSize:J}=B,{getList:K,getElTableExpose:Z,delList:F}=H;C({name:"changeEvent",callback:a=>{"add"===a&&(q.value=1),K()}});const G=()=>{L(`/apps/route/add?app=${j.app}`)},N=o(!1),Q=async a=>{const e=await Z();O.value=a?[a.id]:(null==e?void 0:e.getSelectionRows().map((a=>a.id)))||[],N.value=!0,await F(b(O).length).finally((()=>{N.value=!1}))},V=(a,e)=>{L(`/apps/route/${e}?id=${a.id}`)},W=n([{field:"gateway.cname",label:$("网关")},{field:"gateway.port",label:$("端口")},{field:"app.name",label:$("应用")},{field:"app.domain",label:$("域名")},{field:"app.prefix",label:$("前缀")}]),X=n([{field:"selection",type:"selection"},{field:"index",label:$("tableDemo.index"),type:"index"},{field:"name",label:$("路由")},{field:"remark",label:$("备注")},{field:"frontend.path",label:$("路径")},{field:"status",label:$("状态"),slots:{default:a=>0==a.row.status?d(r("el-tag"),{type:"info"},{default:()=>[p("已停止")]}):d(r("el-tag"),{type:"success"},{default:()=>[p("已启动")]})}},{field:"action",width:"310px",fixed:"right",headerAlign:"center",label:$("tableDemo.action"),slots:{default:a=>{let e,t,l;return d(c,null,[d(u,{type:"primary",onClick:()=>V(a.row,"edit")},z(e=$("exampleDemo.edit"))?e:{default:()=>[e]}),d(u,{type:"success",onClick:()=>V(a.row,"detail")},z(t=$("exampleDemo.detail"))?t:{default:()=>[t]}),d(u,{type:"danger",onClick:()=>Q(a.row)},z(l=$("exampleDemo.del"))?l:{default:()=>[l]}),d(u,{type:"warning",loading:a.row.sloading,onClick:()=>(async a=>{a.sloading=!0,1==a.status?await D(a.id):await S(a.id),a.sloading=!1,K()})(a.row)},{default:()=>[a.row.status?$("关闭"):$("启动")]})])}}}]);return(a,l)=>(m(),g(c,null,[d(b(e),{style:{"margin-bottom":"10px"}},{default:f((()=>[d(b(P),{schema:W,data:A.value},null,8,["schema","data"])])),_:1}),d(b(e),null,{default:f((()=>[y("div",R,[d(b(u),{type:"primary",onClick:G},{default:f((()=>[p(w(b($)("exampleDemo.add")),1)])),_:1}),d(b(u),{loading:N.value,type:"danger",onClick:l[0]||(l[0]=a=>Q(null))},{default:f((()=>[p(w(b($)("exampleDemo.del")),1)])),_:1},8,["loading"]),d(b(u),{onClick:l[1]||(l[1]=a=>b(E)(-1))},{default:f((()=>[p(w(b($)("common.back")),1)])),_:1})]),d(b(t),{pageSize:b(J),"onUpdate:pageSize":l[2]||(l[2]=a=>x(J)?J.value=a:null),currentPage:b(q),"onUpdate:currentPage":l[3]||(l[3]=a=>x(q)?q.value=a:null),columns:X,data:b(M),loading:b(I),pagination:{total:b(T)},onRegister:b(U)},null,8,["pageSize","currentPage","columns","data","loading","pagination","onRegister"])])),_:1})],64))}});export{L as default};
