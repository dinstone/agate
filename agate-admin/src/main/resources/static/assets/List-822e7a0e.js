import{u as e,_ as a,a as t}from"./useTable-f05893b6.js";import{u as o,F as s,i as l}from"./useForm-1b49b077.js";import{d as n,q as i,o as d,c as r,i as c,w as u,a as p,Q as m,K as h,J as g,t as f,O as w,k as b,r as y,y as v,z as x,x as S,e as j,S as k,U as E,V as L,W as R,X as _,Y as C,u as P,s as D,B as F,f as O,P as A,R as z}from"./index-9d34d1b9.js";/* empty css                  */import{u as V}from"./useIcon-8162c381.js";import{g as I,a as T,d as U,c as W,s as q}from"./gateway-eaa5507e.js";import{u as B}from"./useEmitt-312128b0.js";/* empty css                *//* empty css                  */import"./tsxHelper-ddf8f698.js";/* empty css                         *//* empty css                       *//* empty css                   */import"./index-fd6339dd.js";const M=n({__name:"ActionButton",props:{showSearch:i.bool.def(!0),showReset:i.bool.def(!0),showExpand:i.bool.def(!1),visible:i.bool.def(!0),searchLoading:i.bool.def(!1),resetLoading:i.bool.def(!1)},emits:["search","reset","expand"],setup(e,{emit:a}){const{t:t}=b(),o=()=>{a("search")},s=()=>{a("reset")},l=()=>{a("expand")};return(a,n)=>(d(),r(h,null,[e.showSearch?(d(),c(p(w),{key:0,type:"primary",loading:e.searchLoading,icon:p(V)({icon:"ep:search"}),onClick:o},{default:u((()=>[g(f(p(t)("common.query")),1)])),_:1},8,["loading","icon"])):m("",!0),e.showReset?(d(),c(p(w),{key:1,loading:e.resetLoading,icon:p(V)({icon:"ep:refresh-right"}),onClick:s},{default:u((()=>[g(f(p(t)("common.reset")),1)])),_:1},8,["loading","icon"])):m("",!0),e.showExpand?(d(),c(p(w),{key:2,icon:p(V)({icon:e.visible?"ep:arrow-up":"ep:arrow-down"}),text:"",onClick:l},{default:u((()=>[g(f(p(t)(e.visible?"common.shrink":"common.expand")),1)])),_:1},8,["icon"])):m("",!0)],64))}}),N=n({__name:"Search",props:{schema:{type:Array,default:()=>[]},isCol:i.bool.def(!1),labelWidth:i.oneOfType([String,Number]).def("auto"),layout:i.string.validate((e=>["inline","bottom"].includes(e))).def("inline"),buttonPosition:i.string.validate((e=>["left","center","right"].includes(e))).def("center"),showSearch:i.bool.def(!0),showReset:i.bool.def(!0),showExpand:i.bool.def(!1),expandField:i.string.def(""),inline:i.bool.def(!0),removeNoValueItem:i.bool.def(!0),model:{type:Object,default:()=>({})},searchLoading:i.bool.def(!1),resetLoading:i.bool.def(!1)},emits:["search","reset","register","validate"],setup(e,{expose:a,emit:t}){const n=e,i=y(!0),c=y(n.model),u=v((()=>{const e=p(O);let a=E(e.schema);if(e.showExpand&&e.expandField&&!p(i)){const t=L(a,(a=>a.field===e.expandField));a.map(((e,a)=>(e.hidden=a>=t,e)))}return"inline"===e.layout&&(a=a.concat([{field:"action",formItemProps:{labelWidth:"0px",slots:{default:()=>j("div",null,[j(M,{showSearch:e.showSearch,showReset:e.showReset,showExpand:e.showExpand,searchLoading:e.searchLoading,resetLoading:e.resetLoading,visible:i.value,onExpand:T,onReset:V,onSearch:z},null)])}}}])),a})),{formRegister:g,formMethods:f}=o(),{getElFormExpose:w,getFormData:b,getFormExpose:P}=f,D=y({}),F=y({}),O=v((()=>{const e={...n};return Object.assign(e,p(F)),e}));x((()=>p(u)),(async(e=[])=>{c.value=l(e,p(c))}),{immediate:!0,deep:!0});const A=async()=>{const e=await b();return p(O).removeNoValueItem?Object.keys(e).reduce(((a,t)=>{const o=e[t];return R(o)||(_(o)?Object.keys(o).length>0&&(a[t]=o):a[t]=o),a}),{}):e},z=async()=>{const e=await w();await(null==e?void 0:e.validate((async e=>{if(e){const e=await A();t("search",e)}})))},V=async()=>{const e=await w();null==e||e.resetFields();const a=await A();t("reset",a)},I=v((()=>({textAlign:p(O).buttonPosition}))),T=async()=>{i.value=!p(i)},U={getElFormExpose:w,setProps:(e={})=>{F.value=Object.assign(p(F),e),D.value=e},setSchema:e=>{const{schema:a}=p(O);for(const t of a)for(const a of e)t.field===a.field&&C(t,a.path,a.value)},setValues:async(e={})=>{c.value=Object.assign(n.model,p(c),e);const a=await P();null==a||a.setValues(e)},delSchema:e=>{const{schema:a}=p(O),t=L(a,(a=>a.field===e));t>-1&&a.splice(t,1)},addSchema:(e,a)=>{const{schema:t}=p(O);void 0===a?t.push(e):t.splice(a,0,e)}};S((()=>{t("register",U)})),a(U);const W=(e,a,o)=>{t("validate",e,a,o)};return(a,t)=>(d(),r(h,null,[j(p(s),{model:c.value,"is-custom":!1,"label-width":O.value.labelWidth,"hide-required-asterisk":"",inline:O.value.inline,"is-col":O.value.isCol,schema:u.value,onRegister:p(g),onValidate:W},null,8,["model","label-width","inline","is-col","schema","onRegister"]),"bottom"===e.layout?(d(),r("div",{key:0,style:k(I.value)},[j(M,{"show-reset":O.value.showReset,"show-search":O.value.showSearch,"show-expand":O.value.showExpand,"search-loading":O.value.searchLoading,"reset-loading":O.value.resetLoading,onExpand:T,onReset:V,onSearch:z},null,8,["show-reset","show-search","show-expand","search-loading","reset-loading"])],4)):m("",!0)],64))}}),G={class:"mb-10px"};function H(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!z(e)}const $=n({name:"GatewayListPage",__name:"List",setup(o){const{push:s}=P(),{t:l}=b(),n=y({}),i=y([]),{tableRegister:r,tableState:m,tableMethods:v}=e({fetchDataApi:async()=>{const{currentPage:e,pageSize:a}=m,t=await T({pageIndex:p(e),pageSize:p(a),...p(n)});return{list:t.data.list,total:t.data.total}},fetchDelApi:async()=>{if(i.value.length>0){return!!(await U(p(i)))}return!0}}),{loading:x,dataList:S,total:k,currentPage:E,pageSize:L}=m,{getList:R,getElTableExpose:_,delList:C}=v;B({name:"changeEvent",callback:e=>{"add"===e&&(E.value=1),R()}});const z=e=>{n.value=e,R()},V=()=>{s({name:"GatewayAdd"})},M=y(!1),$=async e=>{const a=await _();i.value=e?[e.id]:(null==a?void 0:a.getSelectionRows().map((e=>e.id)))||[],M.value=!0,await C(p(i).length).finally((()=>{M.value=!1}))},J=(e,a)=>{s(`/gateway/${a}?id=${e.id}`)},K=D([{field:"ccode",label:l("集群"),component:"Select",componentProps:{props:{label:"name",value:"code"}},optionApi:async()=>(await I()).data}]),Q=D([{field:"selection",type:"selection"},{field:"index",label:l("tableDemo.index"),type:"index"},{field:"cname",label:l("集群")},{field:"name",label:l("网关")},{field:"port",label:l("端口")},{field:"remark",label:l("备注")},{field:"status",label:l("状态"),slots:{default:e=>0==e.row.status?j(F("el-tag"),{type:"info"},{default:()=>[g("已停止")]}):j(F("el-tag"),{type:"success"},{default:()=>[g("已启动")]})}},{field:"action",width:"310px",fixed:"right",headerAlign:"center",label:l("tableDemo.action"),slots:{default:e=>{let a,t,o;return j(h,null,[j(w,{type:"primary",onClick:()=>J(e.row,"edit")},H(a=l("exampleDemo.edit"))?a:{default:()=>[a]}),j(w,{type:"success",onClick:()=>J(e.row,"detail")},H(t=l("exampleDemo.detail"))?t:{default:()=>[t]}),j(w,{type:"danger",onClick:()=>$(e.row)},H(o=l("exampleDemo.del"))?o:{default:()=>[o]}),j(w,{type:"warning",loading:e.row.sloading,onClick:()=>(async e=>{e.sloading=!0,1==e.status?await W(e.id):await q(e.id),e.sloading=!1,R()})(e.row)},{default:()=>[e.row.status?l("关闭"):l("启动")]})])}}}]);return(e,o)=>(d(),c(p(t),null,{default:u((()=>[j(p(N),{schema:K,onSearch:z,onReset:z},null,8,["schema"]),O("div",G,[j(p(w),{type:"primary",onClick:V},{default:u((()=>[g(f(p(l)("exampleDemo.add")),1)])),_:1}),j(p(w),{loading:M.value,type:"danger",onClick:o[0]||(o[0]=e=>$(null))},{default:u((()=>[g(f(p(l)("exampleDemo.del")),1)])),_:1},8,["loading"])]),j(p(a),{pageSize:p(L),"onUpdate:pageSize":o[1]||(o[1]=e=>A(L)?L.value=e:null),currentPage:p(E),"onUpdate:currentPage":o[2]||(o[2]=e=>A(E)?E.value=e:null),columns:Q,data:p(S),loading:p(x),pagination:{total:p(k)},onRegister:p(r)},null,8,["pageSize","currentPage","columns","data","loading","pagination","onRegister"])])),_:1}))}});export{$ as default};
