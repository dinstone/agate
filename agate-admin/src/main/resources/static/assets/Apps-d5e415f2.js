import{u as e,_ as a,a as t}from"./useTable-2a72c05e.js";import{_ as l}from"./tree-91585a69.js";import{d as i,u as o,r as s,s as n,e as r,O as d,K as p,a as u,o as m,c,w as f,f as g,J as h,t as v,P as y,i as b,Q as _,R as w,k as j}from"./index-5b8751dc.js";/* empty css                  */import{_ as x}from"./Write.vue_vue_type_script_setup_true_lang-c8502536.js";import{_ as S}from"./Detail.vue_vue_type_script_setup_true_lang-0380e26c.js";import{g as D,d as k,s as P}from"./apps-b1fd5c88.js";import{a as C}from"./gateway-29ace984.js";import{u as R}from"./useCrudSchemas-2c80f3ed.js";/* empty css                *//* empty css                  */import"./tsxHelper-11a4c46e.js";/* empty css                         *//* empty css                       */import"./useForm-95be4c91.js";/* empty css                   */import"./useValidator-0a43379b.js";import"./Descriptions-e6f4f0ea.js";import"./index-e446de42.js";const z={class:"mb-10px"};function A(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!w(e)}const I=i({__name:"Apps",setup(i){const{t:w}=j(),{push:I}=o(),L=s([]),{tableRegister:V,tableState:E,tableMethods:O}=e({fetchDataApi:async()=>{const{currentPage:e,pageSize:a}=E,t=await D({pageIndex:u(e),pageSize:u(a)});return{list:t.data.list,total:t.data.total}},fetchDelApi:async()=>!!(await k(u(L)))}),{loading:T,dataList:U,total:H,currentPage:M,pageSize:N}=E,{getList:Q,getElTableExpose:q,delList:B}=O,F=n([{field:"index",label:w("tableDemo.index"),type:"index",search:{hidden:!0},form:{hidden:!0},detail:{hidden:!0}},{field:"gwName",label:w("网关"),search:{hidden:!0},form:{hidden:!0},detail:{hidden:!0}},{field:"gwId",label:w("网关"),search:{hidden:!0},detail:{hidden:!0},table:{hidden:!0},form:{component:"Select",componentProps:{props:{label:"name",value:"id"}},optionApi:async()=>(await C({})).data.list}},{field:"name",label:w("应用"),search:{hidden:!0},form:{component:"Input",colProps:{span:24}},detail:{span:24}},{field:"domain",label:w("域名"),search:{hidden:!0},form:{component:"Input",colProps:{span:24}},detail:{span:24}},{field:"prefix",label:w("前缀"),search:{hidden:!0},form:{component:"Input",colProps:{span:24}},detail:{span:24}},{field:"action",width:"260px",fixed:"right",headerAlign:"center",label:w("tableDemo.action"),search:{hidden:!0},form:{hidden:!0},detail:{hidden:!0},table:{slots:{default:e=>{let a,t,l;return r(p,null,[r(d,{type:"primary",onClick:()=>ee(e.row,"edit")},A(a=w("exampleDemo.edit"))?a:{default:()=>[a]}),r(d,{type:"danger",onClick:()=>$(e.row)},A(t=w("exampleDemo.del"))?t:{default:()=>[t]}),r(d,{type:"warning",onClick:()=>ie(e.row)},A(l=w("路由"))?l:{default:()=>[l]})])}}}}]),{allSchemas:J}=R(F),K=s(!1),W=s(""),Y=s(null),Z=s(""),G=()=>{W.value=w("exampleDemo.add"),Y.value=null,K.value=!0,Z.value=""},X=s(!1),$=async e=>{const a=await q();L.value=e?[e.id]:(null==a?void 0:a.getSelectionRows().map((e=>e.id)))||[],X.value=!0,await B(u(L).length).finally((()=>{X.value=!1}))},ee=(e,a)=>{W.value=w("edit"===a?"exampleDemo.edit":"exampleDemo.detail"),Z.value=a,Y.value=e,K.value=!0},ae=s(),te=s(!1),le=async()=>{const e=u(ae),a=await(null==e?void 0:e.submit());if(a){te.value=!0;await P(a).catch((()=>{})).finally((()=>{te.value=!1}))&&(K.value=!1,M.value=1,Q())}},ie=e=>{I({name:"RouteList",query:{app:e.id}})};return(e,i)=>(m(),c(p,null,[r(u(t),null,{default:f((()=>[g("div",z,[r(u(d),{type:"primary",onClick:G},{default:f((()=>[h(v(u(w)("exampleDemo.add")),1)])),_:1})]),r(u(a),{pageSize:u(N),"onUpdate:pageSize":i[0]||(i[0]=e=>y(N)?N.value=e:null),currentPage:u(M),"onUpdate:currentPage":i[1]||(i[1]=e=>y(M)?M.value=e:null),columns:u(J).tableColumns,data:u(U),loading:u(T),pagination:{total:u(H)},onRegister:u(V)},null,8,["pageSize","currentPage","columns","data","loading","pagination","onRegister"])])),_:1}),r(u(l),{modelValue:K.value,"onUpdate:modelValue":i[3]||(i[3]=e=>K.value=e),title:W.value},{footer:f((()=>["detail"!==Z.value?(m(),b(u(d),{key:0,type:"primary",loading:te.value,onClick:le},{default:f((()=>[h(v(u(w)("exampleDemo.save")),1)])),_:1},8,["loading"])):_("",!0),r(u(d),{onClick:i[2]||(i[2]=e=>K.value=!1)},{default:f((()=>[h(v(u(w)("dialogDemo.close")),1)])),_:1})])),default:f((()=>["detail"!==Z.value?(m(),b(x,{key:0,ref_key:"writeRef",ref:ae,"form-schema":u(J).formSchema,"current-row":Y.value},null,8,["form-schema","current-row"])):_("",!0),"detail"===Z.value?(m(),b(S,{key:1,"detail-schema":u(J).detailSchema,"current-row":Y.value},null,8,["detail-schema","current-row"])):_("",!0)])),_:1},8,["modelValue","title"])],64))}});export{I as default};
